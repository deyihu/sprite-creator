/*!
 * filednd v0.7.0
  */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).filednd=e.filednd||{})}(this,(function(e){"use strict";function t(e){e.stopPropagation(),e.preventDefault()}const i=["dragstart","dragenter","dragend","dragleave","dragover"];let n=0;const s=()=>(n++,n);function r(e,t){for(let i=0,n=t.length;i<n;i++)e.push(t[i]);return e}function o(e,t){const i=t?t.path:"/";e.isFile?e.path=`${i}${e.name}`:e.isDirectory&&(e.path=`${i}${e.name}/`)}function a(e,t){let i=[];const n=[];for(let t=0,r=e.length;t<r;t++){const r=e[t],a=r.webkitGetAsEntry?r.webkitGetAsEntry():r;a.id=s(),n.push(a),a.isDirectory&&i.push(a),o(a)}let a=[],l=!1,c=0;const h=()=>{if(c<i.length){const e=i[c],t=e.createReader(),n=()=>{t.readEntries((t=>{t.length?(t.forEach((t=>{t.id=s(),t.pid=e.id,t.parentName=e.name,o(t,e)})),r(a,t),n()):(c++,h())}))};n()}else{const e=[];a.forEach((t=>{n.push(t),t.isDirectory&&e.push(t)})),i=e,l=!1}},d=setInterval((()=>{0===i.length?(clearInterval(d),(()=>{c=0;const e=()=>{if(c<n.length){const t=n[c];t.isDirectory?(c++,e()):t.file((i=>{i.path=t.path||"/",i.parentName=t.parentName,i.id=t.id,i.pid=t.pid,i.isDirectory=!!i.isDirectory,n[c]=i,c++,e()}))}else t(n)};e()})()):l||(l=!0,a=[],c=0,h())}),1)}e.FileDND=class{constructor(e){var t;e&&e instanceof HTMLElement?(this.ele=e,this.files=[],this._bindEvents=!1,this.emitter={all:t=t||new Map,on:function(e,i){var n=t.get(e);n?n.push(i):t.set(e,[i])},off:function(e,i){var n=t.get(e);n&&(i?n.splice(n.indexOf(i)>>>0,1):t.set(e,[]))},emit:function(e,i){var n=t.get(e);n&&n.slice().map((function(e){e(i)})),(n=t.get("*"))&&n.slice().map((function(t){t(e,i)}))}}):console.error("ele is error,It should be HTMLElement instance")}dnd(e){if(this.ele)if(e){if(!this._bindEvents){i.forEach((e=>{this.ele.addEventListener(e,t)}));const e=e=>{e.stopPropagation(),e.preventDefault();const t=e.dataTransfer.items;this.emitter.emit("readstart",this),a(t,(e=>{const t=this.dndBackCall.bind(this);this.files=e,t(e.filter((e=>e instanceof File))),this.emitter.emit("readend",this)}))};this.dropEvent=e,this._bindEvents=!0,this.ele.addEventListener("drop",e)}this.dndBackCall=e}else console.error("callback is null");else console.error("not find ele")}dispose(){return this._bindEvents&&(i.forEach((e=>{this.ele.removeEventListener(e,t)})),this.ele.removeEventListener("drop",this.dropEvent)),this.ele=null,this.files=null,this.emitter.all.clear(),this}toTree(){const e=this.files,t={};e.forEach((e=>{const{id:i,path:n,name:s,parentName:r}=e;t[i]||(t[i]={id:i,name:s,label:s,path:n,parentName:r,children:[],isDirectory:e.isDirectory})})),e.forEach((e=>{const{pid:i,id:n}=e;t[i]&&t[i].children.push(t[n])}));for(const e in t){const i=t[e].children,n=[],s=[];i.forEach((e=>{e.isDirectory?n.push(e):s.push(e)})),t[e].children=r(n,s)}return Object.values(t).filter((e=>!e.parentName))}clear(){return this.files=[],this}on(e,t){return this.emitter.on(e,t),this}off(e,t){return this.emitter.off(e,t),this}},Object.defineProperty(e,"__esModule",{value:!0})}));
